local vt=init()
vterm.vterm_set_utf8(vt, true)
local state = wantstate(vt, "g")

-- Low
reset(state,screen)
push( "ABC",
  putglyph 41 1 0,0\nputglyph 42 1 0,1\nputglyph 43 1 0,2\n,vt)

-- UTF-8 1 char
# U+00C1 = C3 81  name: LATIN CAPITAL LETTER A WITH ACUTE
# U+00E9 = C3 A9  name: LATIN SMALL LETTER E WITH ACUTE
reset(state,screen)
push( "\xC3\x81\xC3\xA9",
  putglyph c1 1 0,0\nputglyph e9 1 0,1\n,vt)

-- UTF-8 split writes
reset(state,screen)
push( "\xC3",
push( "\x81",
  putglyph c1 1 0,0\n,vt)

-- UTF-8 wide char
# U+FF10 = EF BC 90  name: FULLWIDTH DIGIT ZERO
reset(state,screen)
push( "\xEF\xBC\x90 ",
  putglyph ff10 2 0,0\nputglyph 20 1 0,2,vt)

-- UTF-8 emoji wide char
# U+1F600 = F0 9F 98 80  name: GRINNING FACE
reset(state,screen)
push( "\xF0\x9F\x98\x80 ",
  putglyph 1f600 2 0,0\nputglyph 20 1 0,2,vt)

-- UTF-8 combining chars
# U+0301 = CC 81  name: COMBINING ACUTE
reset(state,screen)
push( "e\xCC\x81Z",
  putglyph 65,301 1 0,0\nputglyph 5a 1 0,1,vt)

-- Combining across buffers
reset(state,screen)
push( "e",
  putglyph 65 1 0,0\npush( "\xCC\x81Z",vt),
  putglyph 65,301 1 0,0\nputglyph 5a 1 0,1,vt)

-- Spare combining chars get truncated
reset(state,screen)
push( "e" . "\xCC\x81" x 10,
  putglyph 65,301,301,301,301,301 1 0,0,vt) # and nothing more

reset(state,screen)
push( "e",
  putglyph 65 1 0,0\npush( "\xCC\x81",vt),
  putglyph 65,301 1 0,0\npush( "\xCC\x82",vt),
  putglyph 65,301,302 1 0,0,vt)

-- DECSCA protected
reset(state,screen)
push( "A\x1b[1\"qB\x1b[2\"qC",
  putglyph 41 1 0,0\nputglyph 42 1 0,1 prot\nputglyph 43 1 0,2,vt)
