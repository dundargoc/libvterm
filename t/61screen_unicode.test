local vt=init()
vterm.vterm_set_utf8(vt, true)
local screen = wantscreen(vt, "")

-- Single width UTF-8
# U+00C1 = C3 81  name: LATIN CAPITAL LETTER A WITH ACUTE
# U+00E9 = C3 A9  name: LATIN SMALL LETTER E WITH ACUTE
reset(state,screen)
push "\xC3\x81\xC3\xA9"
  ?screen_row 0 = c1,e9
  ?screen_text 0,0,1,80 = c3,81,c3,a9
  ?screen_cell 0,0 = {c1} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)

-- Wide char
# U+FF10 = EF BC 90  name: FULLWIDTH DIGIT ZERO
reset(state,screen)
push "0123\x1b[H"
push "\xEF\xBC\x90"
  ?screen_row 0 = ff10,32,33
  ?screen_text 0,0,1,80 = ef,bc,90,32,33
  ?screen_cell 0,0 = {ff10} width=2 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)

-- Combining char
# U+0301 = CC 81  name: COMBINING ACUTE
reset(state,screen)
push "0123\x1b[H"
push "e\xCC\x81"
  ?screen_row 0 = 65,301,31,32,33
  ?screen_text 0,0,1,80 = 65,cc,81,31,32,33
  ?screen_cell 0,0 = {65,301} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)

-- 10 combining accents should not crash
reset(state,screen)
push "e\xCC\x81\xCC\x82\xCC\x83\xCC\x84\xCC\x85\xCC\x86\xCC\x87\xCC\x88\xCC\x89\xCC\x8A"
  ?screen_cell 0,0 = {65,301,302,303,304,305} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)

-- 40 combining accents in two split writes of 20 should not crash
reset(state,screen)
push "e\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81"
push  "\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81\xCC\x81"
  ?screen_cell 0,0 = {65,301,301,301,301,301} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)

-- Outputing CJK doublewidth in 80th column should wraparound to next line and not crash"
reset(state,screen)
push "\x1b[80G\xEF\xBC\x90"
  ?screen_cell 0,79 = {} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)
  ?screen_cell 1,0 = {ff10} width=2 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)
