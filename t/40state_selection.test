local vt=init()
vterm.vterm_set_utf8(vt, true)
local state = wantstate(vt, "")

-- Set clipboard; final chunk len 4
push "\x1b]52;c;SGVsbG8s\x1b\\"
  selection-set mask=0001 ["Hello,"]

-- Set clipboard; final chunk len 3
push "\x1b]52;c;SGVsbG8sIHc=\x1b\\"
  selection-set mask=0001 ["Hello, w"]

-- Set clipboard; final chunk len 2
push "\x1b]52;c;SGVsbG8sIHdvcmxkCg==\x1b\\"
  selection-set mask=0001 ["Hello, world\n"]

-- Set clipboard; split between chunks
push "\x1b]52;c;SGVs"
  selection-set mask=0001 ["Hel"
push "bG8s\x1b\\"
  selection-set mask=0001 "lo,"]

-- Set clipboard; split within chunk
push "\x1b]52;c;SGVsbG"
  selection-set mask=0001 ["Hel"
push "8s\x1b\\"
  selection-set mask=0001 "lo,"]

-- Set clipboard; empty first chunk
push "\x1b]52;c;"
push "SGVsbG8s\x1b\\"
  selection-set mask=0001 ["Hello,"]

-- Set clipboard; empty final chunk
push "\x1b]52;c;SGVsbG8s"
  selection-set mask=0001 ["Hello,"
push "\x1b\\"
  selection-set mask=0001 ]

-- Set clipboard; longer than buffer
push "\x1b]52;c;" . "LS0t"x10 . "\x1b\\"
  selection-set mask=0001 ["-"x15
  selection-set mask=0001 "-"x15]

-- Clear clipboard
push "\x1b]52;c;\x1b\\"
  selection-set mask=0001 []

-- Set invalid data clears and ignores
push "\x1b]52;c;SGVs*SGVsbG8s\x1b\\"
  selection-set mask=0001 []

-- Query clipboard
push "\x1b]52;c;?\x1b\\"
  selection-query mask=0001

-- Send clipboard; final chunk len 4
SELECTION 1 ["Hello,"]
  output "\x1b]52;c;"
  output "SGVsbG8s"
  output "\x1b\\"

-- Send clipboard; final chunk len 3
SELECTION 1 ["Hello, w"]
  output "\x1b]52;c;"
  output "SGVsbG8s"
  output "IHc=\x1b\\"

-- Send clipboard; final chunk len 2
SELECTION 1 ["Hello, world\n"]
  output "\x1b]52;c;"
  output "SGVsbG8sIHdvcmxk"
  output "Cg==\x1b\\"

-- Send clipboard; split between chunks
SELECTION 1 ["Hel"
  output "\x1b]52;c;"
  output "SGVs"
SELECTION 1  "lo,"]
  output "bG8s"
  output "\x1b\\"

-- Send clipboard; split within chunk
SELECTION 1 ["Hello"
  output "\x1b]52;c;"
  output "SGVs"
SELECTION 1 ","]
  output "bG8s"
  output "\x1b\\"
