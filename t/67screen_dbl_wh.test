local vt=init()
local screen = wantscreen(vt, "")

reset(state,screen)

-- Single Width, Single Height
reset(state,screen)
push "\x1b#5"
push "abcde"
  ?screen_cell 0,0 = {61} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)

-- Double Width, Single Height
reset(state,screen)
push "\x1b#6"
push "abcde"
  ?screen_cell 0,0 = {61} width=1 attrs={} dwl fg=rgb(240,240,240) bg=rgb(0,0,0)

-- Double Height
reset(state,screen)
push "\x1b#3"
push "abcde"
push "\r\n\x1b#4"
push "abcde"
  ?screen_cell 0,0 = {61} width=1 attrs={} dwl dhl-top fg=rgb(240,240,240) bg=rgb(0,0,0)
  ?screen_cell 1,0 = {61} width=1 attrs={} dwl dhl-bottom fg=rgb(240,240,240) bg=rgb(0,0,0)

-- Late change
reset(state,screen)
push "abcde"
  ?screen_cell 0,0 = {61} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)
push "\x1b#6"
  ?screen_cell 0,0 = {61} width=1 attrs={} dwl fg=rgb(240,240,240) bg=rgb(0,0,0)

-- DWL doesn't spill over on scroll
reset(state,screen)
push "\x1b[25H\x1b#6Final\r\n"
  ?screen_cell 23,0 = {46} width=1 attrs={} dwl fg=rgb(240,240,240) bg=rgb(0,0,0)
  ?screen_cell 24,0 = {} width=1 attrs={} fg=rgb(240,240,240) bg=rgb(0,0,0)
