local vt=init()
# Run these tests on a much smaller default screen, so debug output is
# nowhere near as noisy
resize(5,10,vt)
local state = wantstate(vt, "")
local screen = wantscreen(vt, "") r
reset(state,screen)

-- Resize wider reflows wide lines
reset(state,screen)
push "A"x12
  ?screen_row 0 = "AAAAAAAAAA"
  ?screen_row 1 = "AA"
  ?lineinfo 1 = cont
  ?cursor = 1,2
resize(5,15,vt)
  ?screen_row 0 = "AAAAAAAAAAAA"
  ?screen_row 1 = 
  ?lineinfo 1 =
  ?cursor = 0,12
resize(5,20,vt)
  ?screen_row 0 = "AAAAAAAAAAAA"
  ?screen_row 1 = 
  ?lineinfo 1 =
  ?cursor = 0,12

-- Resize narrower can create continuation lines
reset(state,screen)
resize(5,10,vt)
push "ABCDEFGHI"
  ?screen_row 0 = "ABCDEFGHI"
  ?screen_row 1 = ""
  ?lineinfo 1 =
  ?cursor = 0,9
resize(5,8,vt)
  ?screen_row 0 = "ABCDEFGH"
  ?screen_row 1 = "I"
  ?lineinfo 1 = cont
  ?cursor = 1,1
resize(5,6,vt)
  ?screen_row 0 = "ABCDEF"
  ?screen_row 1 = "GHI"
  ?lineinfo 1 = cont
  ?cursor = 1,3

-- Shell wrapped prompt behaviour
reset(state,screen)
resize(5,10,vt)
push "PROMPT GOES HERE\r\n> \r\n\r\nPROMPT GOES HERE\r\n> "
  ?screen_row 0 = "> "
  ?screen_row 1 = ""
  ?screen_row 2 = "PROMPT GOE"
  ?screen_row 3 = "S HERE"
  ?lineinfo 3 = cont
  ?screen_row 4 = "> "
  ?cursor = 4,2
resize(5,11,vt)
  ?screen_row 0 = "> "
  ?screen_row 1 = ""
  ?screen_row 2 = "PROMPT GOES"
  ?screen_row 3 = " HERE"
  ?lineinfo 3 = cont
  ?screen_row 4 = "> "
  ?cursor = 4,2
resize(5,12,vt)
  ?screen_row 0 = "> "
  ?screen_row 1 = ""
  ?screen_row 2 = "PROMPT GOES "
  ?screen_row 3 = "HERE"
  ?lineinfo 3 = cont
  ?screen_row 4 = "> "
  ?cursor = 4,2
resize(5,16,vt)
  ?screen_row 0 = "> "
  ?screen_row 1 = ""
  ?screen_row 2 = "PROMPT GOES HERE"
  ?lineinfo 3 =
  ?screen_row 3 = "> "
  ?cursor = 3,2

-- Cursor goes missing
# For more context: https://github.com/neovim/neovim/pull/21124
reset(state,screen)
resize(5,5,vt)
resize(3,1,vt)
push "\x1b[2;1Habc\r\n\x1b[H"
resize(1,1,vt)
  ?cursor = 0,0
