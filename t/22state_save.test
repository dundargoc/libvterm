local vt=init()
local state = wantstate(vt, "") p

reset(state,screen)
  settermprop 1 true
  settermprop 2 true
  settermprop 7 1

-- Set up state
push "\x1b[2;2H"
  ?cursor = 1,1
push "\x1b[1m"
  ?pen bold = on

-- Save
push "\x1b[?1048h"

-- Change state
push "\x1b[5;5H"
  ?cursor = 4,4
push "\x1b[4 q"
  settermprop 2 false
  settermprop 7 2
push "\x1b[22;4m"
  ?pen bold = off
  ?pen underline = 1

-- Restore
push "\x1b[?1048l"
  settermprop 1 true
  settermprop 2 true
  settermprop 7 1
  ?cursor = 1,1
  ?pen bold = on
  ?pen underline = 0

-- Save/restore using DECSC/DECRC
push "\x1b[2;2H\x1b7"
  ?cursor = 1,1

push "\x1b[5;5H"
  ?cursor = 4,4
push "\x1b8"
  settermprop 1 true
  settermprop 2 true
  settermprop 7 1
  ?cursor = 1,1

-- Save twice, restore twice happens on both edge transitions
push "\x1b[2;10H\x1b[?1048h\x1b[6;10H\x1b[?1048h"
push "\x1b[H"
  ?cursor = 0,0
push "\x1b[?1048l"
  settermprop 1 true
  settermprop 2 true
  settermprop 7 1
  ?cursor = 5,9
push "\x1b[H"
  ?cursor = 0,0
push "\x1b[?1048l"
  settermprop 1 true
  settermprop 2 true
  settermprop 7 1
  ?cursor = 5,9
