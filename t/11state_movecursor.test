local vt=init()
vterm.vterm_set_utf8(vt, true)
local state = wantstate(vt, "")

-- Implicit
push "ABC"
  ?cursor = 0,3
-- Backspace
push "\b"
  ?cursor = 0,2
-- Horizontal Tab
push "\t"
  ?cursor = 0,8
-- Carriage Return
push "\r"
  ?cursor = 0,0
-- Linefeed
push "\n"
  ?cursor = 1,0

-- Backspace bounded by lefthand edge
push "\x1b[4;2H"
  ?cursor = 3,1
push "\b"
  ?cursor = 3,0
push "\b"
  ?cursor = 3,0

-- Backspace cancels phantom
push "\x1b[4;80H"
  ?cursor = 3,79
push "X"
  ?cursor = 3,79
push "\b"
  ?cursor = 3,78

-- HT bounded by righthand edge
push "\x1b[1;78H"
  ?cursor = 0,77
push "\t"
  ?cursor = 0,79
push "\t"
  ?cursor = 0,79

reset(state,screen)

-- Index
push "ABC\x1bD"
  ?cursor = 1,3
-- Reverse Index
push "\x1bM"
  ?cursor = 0,3
-- Newline
push "\x1bE"
  ?cursor = 1,0

reset(state,screen)

-- Cursor Forward
push "\x1b[B"
  ?cursor = 1,0
push "\x1b[3B"
  ?cursor = 4,0
push "\x1b[0B"
  ?cursor = 5,0

-- Cursor Down
push "\x1b[C"
  ?cursor = 5,1
push "\x1b[3C"
  ?cursor = 5,4
push "\x1b[0C"
  ?cursor = 5,5

-- Cursor Up
push "\x1b[A"
  ?cursor = 4,5
push "\x1b[3A"
  ?cursor = 1,5
push "\x1b[0A"
  ?cursor = 0,5

-- Cursor Backward
push "\x1b[D"
  ?cursor = 0,4
push "\x1b[3D"
  ?cursor = 0,1
push "\x1b[0D"
  ?cursor = 0,0

-- Cursor Next Line
push "   "
  ?cursor = 0,3
push "\x1b[E"
  ?cursor = 1,0
push "   "
  ?cursor = 1,3
push "\x1b[2E"
  ?cursor = 3,0
push "\x1b[0E"
  ?cursor = 4,0

-- Cursor Previous Line
push "   "
  ?cursor = 4,3
push "\x1b[F"
  ?cursor = 3,0
push "   "
  ?cursor = 3,3
push "\x1b[2F"
  ?cursor = 1,0
push "\x1b[0F"
  ?cursor = 0,0

-- Cursor Horizonal Absolute
push "\n"
  ?cursor = 1,0
push "\x1b[20G"
  ?cursor = 1,19
push "\x1b[G"
  ?cursor = 1,0

-- Cursor Position
push "\x1b[10;5H"
  ?cursor = 9,4
push "\x1b[8H"
  ?cursor = 7,0
push "\x1b[H"
  ?cursor = 0,0

-- Cursor Position cancels phantom
push "\x1b[10;78H"
  ?cursor = 9,77
push "ABC"
  ?cursor = 9,79
push "\x1b[10;80H"
push "C"
  ?cursor = 9,79
push "X"
  ?cursor = 10,1

reset(state,screen)

-- Bounds Checking
push "\x1b[A"
  ?cursor = 0,0
push "\x1b[D"
  ?cursor = 0,0
push "\x1b[25;80H"
  ?cursor = 24,79
push "\x1b[B"
  ?cursor = 24,79
push "\x1b[C"
  ?cursor = 24,79
push "\x1b[E"
  ?cursor = 24,0
push "\x1b[H"
  ?cursor = 0,0
push "\x1b[F"
  ?cursor = 0,0
push "\x1b[999G"
  ?cursor = 0,79
push "\x1b[99;99H"
  ?cursor = 24,79

reset(state,screen)

-- Horizontal Position Absolute
push "\x1b[5`"
  ?cursor = 0,4

-- Horizontal Position Relative
push "\x1b[3a"
  ?cursor = 0,7

-- Horizontal Position Backward
push "\x1b[3j"
  ?cursor = 0,4

-- Horizontal and Vertical Position
push "\x1b[3;3f"
  ?cursor = 2,2

-- Vertical Position Absolute
push "\x1b[5d"
  ?cursor = 4,2

-- Vertical Position Relative
push "\x1b[2e"
  ?cursor = 6,2

-- Vertical Position Backward
push "\x1b[2k"
  ?cursor = 4,2

reset(state,screen)

-- Horizontal Tab
push "\t"
  ?cursor = 0,8
push "   "
  ?cursor = 0,11
push "\t"
  ?cursor = 0,16
push "       "
  ?cursor = 0,23
push "\t"
  ?cursor = 0,24
push "        "
  ?cursor = 0,32
push "\t"
  ?cursor = 0,40

-- Cursor Horizontal Tab
push "\x1b[I"
  ?cursor = 0,48
push "\x1b[2I"
  ?cursor = 0,64

-- Cursor Backward Tab
push "\x1b[Z"
  ?cursor = 0,56
push "\x1b[2Z"
  ?cursor = 0,40
